<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Part Number Generator - PDM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .prefix-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .prefix-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prefix-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .prefix-info {
            font-size: 14px;
            color: #666;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .number-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .number-box:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .number-box.copied {
            border-color: #28a745;
            background: #d4edda;
        }

        .number-box.disappearing {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.4s ease-out;
        }

        .number-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .copy-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .number-box.copied .copy-indicator {
            display: flex;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
            font-size: 16px;
        }

        .error {
            text-align: center;
            padding: 60px;
            color: #dc3545;
            font-size: 16px;
        }

        .instructions {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #17a2b8;
        }

        .instructions h3 {
            color: #0c5460;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instructions p {
            color: #0c5460;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Part Number Generator</h1>
            <p>Click any part number to copy it to clipboard</p>
        </div>

        <div class="content">
            <div class="instructions">
                <h3>ðŸ“‹ How to Use</h3>
                <p>These are the next 50 available part numbers for each prefix. Numbers increment by 10 from the highest existing number. Click any number to copy it to your clipboard for use in Creo.</p>
            </div>

            <div id="prefixContainer">
                <div class="loading">Loading available part numbers...</div>
            </div>
        </div>
    </div>

    <script>
        let prefixData = {};

        async function loadAvailableNumbers() {
            try {
                const response = await fetch('/api/available-numbers');
                if (!response.ok) throw new Error('Failed to load data');
                
                prefixData = await response.json();
                renderPrefixes();
            } catch (error) {
                document.getElementById('prefixContainer').innerHTML = 
                    `<div class="error">Error loading part numbers: ${error.message}</div>`;
            }
        }

        function renderPrefixes() {
            const container = document.getElementById('prefixContainer');
            
            if (Object.keys(prefixData).length === 0) {
                container.innerHTML = '<div class="error">No prefixes found in database</div>';
                return;
            }

            container.innerHTML = '';

            Object.keys(prefixData).sort().forEach(prefix => {
                const data = prefixData[prefix];
                
                const section = document.createElement('div');
                section.className = 'prefix-section';
                
                section.innerHTML = `
                    <div class="prefix-header">
                        <div class="prefix-title">${prefix}#####</div>
                        <div class="prefix-info">
                            Highest in use: <strong>${prefix}${String(data.highest).padStart(5, '0')}</strong> | 
                            Next available: <strong>${prefix}${String(data.next_start).padStart(5, '0')}</strong>
                        </div>
                    </div>
                    <div class="numbers-grid" id="grid-${prefix}"></div>
                `;
                
                container.appendChild(section);
                
                const grid = document.getElementById(`grid-${prefix}`);
                data.available.forEach(num => {
                    const box = document.createElement('div');
                    box.className = 'number-box';
                    const partNumber = `${prefix}${String(num).padStart(5, '0')}`;
                    
                    box.innerHTML = `
                        <div class="number-text">${partNumber}</div>
                        <div class="copy-indicator">âœ“</div>
                    `;
                    
                    box.addEventListener('click', () => copyToClipboard(partNumber, box));
                    grid.appendChild(box);
                });
            });
        }

        function copyToClipboard(text, element) {
            // Use textarea method - works everywhere
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                
                // Add disappearing animation
                element.classList.add('disappearing');
                
                // Remove element after animation completes
                setTimeout(() => {
                    element.remove();
                }, 400);
                
            } catch (err) {
                console.error('Failed to copy:', err);
                alert('Failed to copy: ' + text);
            } finally {
                document.body.removeChild(textarea);
            }
        }

        loadAvailableNumbers();
    </script>
</body>
</html>