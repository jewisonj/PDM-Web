# PDM-Web Docker Compose Configuration
# Database/Auth/Storage: Supabase (cloud)
# Local services: FreeCAD Worker only

services:
  # FreeCAD Worker - processes CAD files (DXF flat patterns, SVG bend drawings)
  freecad-worker:
    build:
      context: .
      dockerfile: worker/Dockerfile
    container_name: pdm-freecad-worker
    volumes:
      # Mount file storage for input/output
      - ./files:/data/files
      # Mount FreeCAD processing scripts (read-only)
      - ./FreeCAD/Tools:/scripts/tools:ro
      # Mount worker helper scripts (read-only)
      - ./worker/scripts:/scripts/worker:ro
      # Mount SheetMetal addon
      - ./FreeCAD/Mod/sheetmetal:/root/.FreeCAD/Mod/sheetmetal:ro
    environment:
      - PYTHONPATH=/usr/local/lib:/root/.FreeCAD/Mod/sheetmetal:/scripts/worker
    working_dir: /data
    # Keep container running for job execution
    command: ["tail", "-f", "/dev/null"]
